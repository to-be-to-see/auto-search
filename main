
import time
from selenium.webdriver.common.by import By
from selenium import webdriver
from webdriver_manager.chrome import ChromeDriverManager
from selenium.webdriver.support.wait import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
driver = webdriver.Chrome(ChromeDriverManager().install())



driver.get('https://applications.edb.gov.hk/schoolsearch/schoolsearch.aspx?type=nonformal&langno=2&eng_name=&chi_name=&sch_no=&sch_reg_no=&session=&gender=&region=&district=&level=&SchType=&SpSchType=&fin_type=&sch_addr=')


# Click search btn
WebDriverWait(driver, 10).until(
    EC.presence_of_element_located((By.XPATH, '//*[@id="MainContentPlaceHolder_btnSearch"]')))
driver.find_element(By.XPATH, value='//*[@id="MainContentPlaceHolder_btnSearch"]').click()



# Wait for webpage to load
WebDriverWait(driver, 10).until(
    EC.presence_of_element_located((By.XPATH, '//*[@id="Form1"]/div[3]/div/div[2]/div[2]/div[2]/div[2]/a')))



# Load div number record // create
try:
    with open('C:/Users/Luck/Desktop/progress_record.txt', 'r') as progress_record_txt:
        progress_record = progress_record_txt.read()
except:
    with open('C:/Users/Luck/Desktop/progress_record.txt', 'w') as progress_record_txt:
        progress_record_txt.write('2')
        progress_record ='2'




# Save last school name to check for identical school
last_cut_tutorial_school_name = ''

# Save id of name list window
main_tab = driver.current_window_handle

# Get names of tutorial schools
while 1:
    # Focus main window
    driver.switch_to.window(main_tab)



    # Get full text
    tutorial_school_name =driver.find_element(By.XPATH,
                        value='//*[@id="Form1"]/div[3]/div/div[2]/div[' + progress_record + ']/div[2]/div[2]/a').text


    # Get Chinese text only
    cut_tutorial_school_name, useless_variable = tutorial_school_name.split('[', 1)


    # Skip same tutorial school
    if cut_tutorial_school_name == last_cut_tutorial_school_name:
        # Progress record +1
        with open('C:/Users/Luck/Desktop/progress_record.txt', 'w') as progress_record_txt:
            progress_record_int = int(progress_record) + 1
            progress_record = str(progress_record_int)
            progress_record_txt.write(progress_record)
        continue


    # Save tutorial school name
    last_cut_tutorial_school_name = cut_tutorial_school_name


    # Open new tab
    driver.switch_to.new_window('tab')


    # Search tutorial school name
    driver.get('https://www.google.com/search?q='+ cut_tutorial_school_name)
    print("School: " +cut_tutorial_school_name)

    # Ask whether finished searching
    input("Finished Press Enter")


    # Close tabs
    tab_list = driver.window_handles
    for tab_id in tab_list:
        if tab_id != main_tab:
            driver.switch_to.window(tab_id)
            driver.close()



    # Change record by 1
    with open('C:/Users/Luck/Desktop/progress_record.txt', 'w') as progress_record_txt:
        progress_record_int = int(progress_record) + 1
        progress_record = str(progress_record_int)
        progress_record_txt.write(progress_record)

